# BMF - Business Model Format

A specification format for defining mobile app business logic, screens, entities, and workflows.

## Prerequisites

- **Node.js** >= 18.x
- **npm** >= 9.x
- **Browser**: Chrome, Edge, or Opera (for File System Access API support)

## Project Structure

```
bmf/
├── viewer/           # React-based BMF viewer application
├── bmfs/             # BMF specification projects
│   └── {project}/    # Individual project specs
│       ├── *.yaml    # Spec files (entities, screens, actions, etc.)
│       └── _comments.yaml  # Comments for spec review
├── templates/        # BMF templates and examples
└── .claude/
    └── commands/     # Claude Code slash commands
```

## Running the Viewer

### Development Mode

```bash
cd viewer
npm install
npm run dev
```

Open http://localhost:5173 in your browser.

### Production Build

```bash
cd viewer
npm run build
npm run preview
```

### Using the Viewer

1. Click **"Open Spec Folder"** to select a BMF project directory
2. The viewer will load all `.yaml` files and display the navigation graph
3. Click on nodes to view entity details
4. Press **C** to add/edit comments on selected entities
5. Comments are automatically saved to `_comments.yaml` in the project folder

## Claude Code Commands

### `/bmf-comments {project}`

Review and resolve comments in a BMF specification.

```bash
/bmf-comments jumpster
```

**Behavior:**

- Loads comments from `bmfs/{project}/_comments.yaml`
- Reviews each unresolved comment
- **Resolves by default** if the specification is clear
- Only keeps comments open if clarification is genuinely needed
- Saves changes back to `_comments.yaml`

**Output:**

- Summary of total/resolved/open comments
- Resolution notes for each processed comment

## Comments System

Comments are stored in `_comments.yaml` within each project folder:

```yaml
# BMF Comments
# Generated by BMF Viewer

entity:users:user:
  text: "Need to add email validation"
  createdAt: 1704067200000
  resolved: false

screen:home:main:
  text: "Missing loading state"
  createdAt: 1704067200000
  resolved: true
  resolution: "Added loading component"
  questions:
    - question: "Should we show a spinner or skeleton?"
      answer: "Use skeleton loader for better UX"
```

### Comment Fields

| Field | Type | Description |
|-------|------|-------------|
| `text` | string | Main comment content |
| `createdAt` | number | Unix timestamp (milliseconds) |
| `resolved` | boolean | Whether the comment is resolved |
| `resolution` | string | Optional resolution notes |
| `questions` | array | Q&A thread for discussions |

## BMF Spec Format

BMF specs use YAML files organized by entity type:

- `entities/*.yaml` - Data models
- `screens/*.yaml` - UI screens
- `actions/*.yaml` - Business logic actions
- `dialogs/*.yaml` - Modal dialogs
- `components/*.yaml` - Reusable UI components
- `context.yaml` - Global app context and triggers
- `actors.yaml` - User roles and permissions

## Development

### Viewer Tech Stack

- React 18
- TypeScript
- Zustand (state management)
- XY Flow (graph visualization)
- Vite (build tool)

### Running Tests

```bash
cd viewer
npm test
npm run test:e2e
```

### Type Checking

```bash
cd viewer
npm run typecheck
```
