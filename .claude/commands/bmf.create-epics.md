---
description: Generate _epics.yaml for a BMF project by analyzing its YAML structure and creating epic descriptions.
---

## User Input

```text
$ARGUMENTS
```

## Overview

Analyze BMF specification files in a folder and generate an `_epics.yaml` file with epic definitions. Epics are high-level groups of related functionality that describe "what" the system does and "why" it's valuable to users.

## Execution

### 1. Parse Arguments

Extract from `$ARGUMENTS`:
- `folder` - path to BMF project folder (e.g., `bmfs/examples/marketplace`)
- `lang` - language for descriptions (e.g., `en`, `ru`)

If folder is empty, list available projects in `bmfs/` and ask user to specify.

Default: `lang = en`

### 2. Read Template

Read the template from `bmfs/template/_epics.yaml` to understand:
- Epic ID format (`epic:domain` or `epic:domain:subdomain`)
- Description format (what it is + why user needs it)
- Rules for creating subepics

### 3. Analyze Project Structure

Read all `.yaml` files in the specified folder (excluding `_*.yaml` files).

Extract and group by domain:
- `entity:domain:name` - data models
- `screen:domain:name` - UI screens
- `action:domain:name` - business actions
- `dialog:domain:name` - modal dialogs
- `event:domain:name` - system events
- `layout:name` - layouts
- `component:domain:name` - reusable components

Build a domain map:
```
domain -> {
  entities: [...],
  screens: [...],
  actions: [...],
  dialogs: [...],
  events: [...],
  components: [...]
}
```

### 4. Determine Epic Hierarchy

For each domain with 3+ elements:
1. Create root epic `epic:domain`
2. If domain has clear subdomains (from entity/screen names), create subepics `epic:domain:subdomain`

Rules for subepics:
- Only create if 3+ related entities/screens exist
- Subepics should represent releasable chunks of functionality
- Max 2 levels of hierarchy

### 5. Generate Descriptions

For each epic, generate description in specified language:

**Minimal format (for simple epics):**
```yaml
epic:domain:
  description: |
    What it is (1 sentence).
    Why user needs it (1 sentence).
```

**Extended format (for complex epics with 5+ elements):**
```yaml
epic:domain:
  description: |
    What it is - brief definition.
    Why user needs it - what problem it solves.

    Includes: free-form summary of key functionality (3-5 sentences).
    Limitations: what's NOT included.
```

"Includes" should read naturally as prose (3-5 sentences), not a bulleted list. Describe key user flows and capabilities.

Description guidelines by language:

**English (en):**
- Use active voice
- Focus on user value
- Be concise

**Russian (ru):**
- Use present tense
- Focus on user benefit
- Keep it brief

### 6. Generate _epics.yaml

Create file at `{folder}/_epics.yaml` with format:

```yaml
# yaml-language-server: $schema=../../schema.json
# Epics - Feature Groups
#
# Auto-generated by bmf.create-epics

epic:domain:
  description: |
    ...

epic:domain:subdomain:
  description: |
    ...
```

Sort epics:
1. Root epics first, alphabetically
2. Then subepics under their parent, alphabetically

### 7. Report Summary

After generation, report:
- Total epics created: N
- Root epics: N
- Subepics: N
- Domains covered: list

## Example Output

For a marketplace project:

```yaml
# yaml-language-server: $schema=../../schema.json
# Epics - Feature Groups

epic:account:
  description: |
    User account and personal cabinet.
    User manages profile, addresses, and views order history.

    Includes viewing and editing personal info like name and phone.
    User can add, edit, and delete delivery addresses.
    Addresses can be marked as default for faster checkout.
    Order history shows all past purchases with status and details.

epic:auth:
  description: |
    Authentication and session management.
    User can log in, register, and recover access.

    Includes email/password login with error handling.
    New users register with name, email, phone and password.
    Forgot password flow sends reset link to email.
    Successful auth redirects to profile screen.

epic:cart:
  description: |
    Shopping cart functionality.
    User collects products before checkout.

epic:catalog:
  description: |
    Product catalog and browsing.
    User discovers and views products by categories.

epic:checkout:
  description: |
    Order placement flow.
    User selects delivery address and confirms the order.

epic:orders:
  description: |
    Order management and history.
    User tracks order status and views past purchases.

epic:shop:
  description: |
    Main storefront experience.
    User sees featured products and navigates to catalog.
```

## Behavior Rules

- Never overwrite existing `_epics.yaml` without confirmation
- Use consistent language throughout descriptions
- Base descriptions on actual functionality found in specs
- Include only epics that have corresponding spec elements
- Schema path should be relative to the epics file location
